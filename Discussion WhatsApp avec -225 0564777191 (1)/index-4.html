<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Syst√®me de Gestion FTTH Pro</title>
    <style>
        :root {
            --primary-color: #1e3c72;
            --secondary-color: #2a5298;
            --accent-color: #4CAF50;
            --warning-color: #FFA500;
            --danger-color: #f44336;
            --background-light: #f4f7f9;
            --background-dark: #e0e6ed;
            --text-color: #333;
            --text-light: #fff;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--background-light);
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            color: var(--primary-color);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 1.1em;
            color: #666;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: var(--text-light);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .control-panel {
            padding: 20px;
        }

        .tabs {
            display: flex;
            justify-content: space-around;
            border-bottom: 2px solid var(--background-dark);
            margin-bottom: 20px;
        }

        .tab {
            background: none;
            border: none;
            padding: 15px 20px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--secondary-color);
            font-weight: 600;
            position: relative;
        }

        .tab.active {
            color: var(--primary-color);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: var(--background-dark);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: 700;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 1em;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .data-table {
            background-color: var(--background-dark);
            border-radius: 10px;
            padding: 20px;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .table-header h3 {
            color: var(--primary-color);
        }

        .search-box {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            width: 300px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background-color: var(--text-light);
            border-radius: 8px;
            overflow: hidden;
        }

        th, td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: var(--secondary-color);
            color: var(--text-light);
            font-weight: 600;
            text-transform: uppercase;
        }

        tr:hover {
            background-color: #f1f1f1;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: bold;
            color: var(--text-light);
            font-size: 0.8em;
            text-transform: capitalize;
        }

        .status-badge.status-active { background-color: var(--accent-color); }
        .status-badge.status-pending { background-color: var(--warning-color); }
        .status-badge.status-completed { background-color: #2196F3; }
        .status-badge.status-tirage { background-color: #9c27b0; }
        .status-badge.status-config { background-color: #ff5722; }

        .action-buttons {
            white-space: nowrap;
        }

        .btn-small {
            padding: 6px 10px;
            font-size: 0.8em;
            margin-right: 5px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--primary-color);
        }

        .form-group input, .form-group select {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1em;
        }

        .form-group input[type="file"] {
            padding: 0;
        }

        .buttons {
            text-align: center;
            margin-top: 30px;
        }

        .btn-primary, .btn-warning, .btn-danger {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            color: var(--text-light);
            transition: background-color 0.3s ease;
            margin: 0 10px;
        }

        .btn-primary { background-color: var(--primary-color); }
        .btn-primary:hover { background-color: var(--secondary-color); }

        .btn-warning { background-color: var(--warning-color); }
        .btn-warning:hover { background-color: #e69500; }

        .btn-danger { background-color: var(--danger-color); }
        .btn-danger:hover { background-color: #d32f2f; }

        .photo-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .photo-item {
            text-align: center;
        }

        .photo-preview {
            width: 100%;
            height: 150px;
            background-color: var(--background-dark);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            color: #aaa;
            margin-bottom: 10px;
            overflow: hidden;
        }

        .checkbox-group {
            margin-top: 20px;
            display: flex;
            align-items: center;
        }

        .checkbox-group label {
            margin-left: 10px;
            font-weight: 600;
            color: var(--primary-color);
        }

        .poteau-section {
            display: none;
            padding: 20px;
            background-color: var(--background-dark);
            border-radius: 8px;
            margin-top: 15px;
        }

        .poteau-section.active {
            display: block;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.4);
            padding-top: 60px;
            overflow: auto;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            border-radius: 12px;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .photo-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .photo-gallery img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
        }

        .notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;
            z-index: 100;
        }
        
        .notification.show {
            opacity: 1;
            visibility: visible;
        }

        .notification.success {
            background-color: var(--accent-color);
        }

        .notification.error {
            background-color: var(--danger-color);
        }

        /* Styles pour les rapports et l'exportation */
        .report-form, .export-options {
            padding: 20px;
            background-color: var(--background-dark);
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .report-form .form-grid {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }

        #report-content {
            margin-top: 20px;
        }

    </style>
</head>
<body>
    <div class="header">
        <h1>üåê Syst√®me de Gestion FTTH Pro</h1>
        <p>Gestion compl√®te des installations fibre optique avec photos et rapports.</p>
    </div>

    <div class="container">
        <div class="control-panel">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('dashboard')">üìä Tableau de bord</button>
                <button class="tab" onclick="switchTab('add-client')">‚ûï Nouveau client</button>
                <button class="tab" onclick="switchTab('manage')">‚öô Gestion</button>
                <button class="tab" onclick="switchTab('reports')">üìã Bilans</button>
                <button class="tab" onclick="switchTab('export')">üì§ Export</button>
            </div>

            <div id="dashboard" class="tab-content active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalClients">0</div>
                        <div class="stat-label">Total clients</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="activeInstallations">0</div>
                        <div class="stat-label">Connexions actives</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pendingInstallations">0</div>
                        <div class="stat-label">En attente</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="completedToday">0</div>
                        <div class="stat-label">Termin√©es aujourd'hui</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="tirageEnCours">0</div>
                        <div class="stat-label">Tirage en cours</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="attenteCofig">0</div>
                        <div class="stat-label">En attente config.</div>
                    </div>
                </div>

                <div class="data-table">
                    <div class="table-header">
                        <h3>Liste des clients</h3>
                        <input type="text" class="search-box" id="searchInput" placeholder="Rechercher un client..." onkeyup="filterTable('clientsTableBody', this.value)">
                    </div>
                    <table id="clientsTable">
                        <thead>
                            <tr>
                                <th>Nom</th>
                                <th>Contact</th>
                                <th>Ville</th>
                                <th>Quartier</th>
                                <th>Num√©ro FTTH</th>
                                <th>Statut</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="clientsTableBody"></tbody>
                    </table>
                </div>
            </div>

            <div id="add-client" class="tab-content">
                <div class="form-section">
                    <h3 style="margin-bottom: 20px; color: #1e3c72;">üë§ Informations client</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="clientName">Nom du client</label>
                            <input type="text" id="clientName" placeholder="Nom complet" required>
                        </div>
                        <div class="form-group">
                            <label for="contactPrincipal">Contact principal</label>
                            <input type="text" id="contactPrincipal" placeholder="Num√©ro de t√©l√©phone" required>
                        </div>
                        <div class="form-group">
                            <label for="contactSecondaire">Contact secondaire (optionnel)</label>
                            <input type="text" id="contactSecondaire" placeholder="Autre num√©ro">
                        </div>
                        <div class="form-group">
                            <label for="ville">Ville</label>
                            <input type="text" id="ville" placeholder="Ville" required>
                        </div>
                        <div class="form-group">
                            <label for="quartier">Quartier</label>
                            <input type="text" id="quartier" placeholder="Quartier">
                        </div>
                        <div class="form-group">
                            <label for="numeroFTTH">Num√©ro FTTH</label>
                            <input type="text" id="numeroFTTH" placeholder="Num√©ro FTTH">
                        </div>
                        <div class="form-group">
                            <label for="statusInstallation">Statut</label>
                            <select id="statusInstallation" required>
                                <option value="pending">En attente</option>
                                <option value="active">Active</option>
                                <option value="completed">Termin√©e</option>
                                <option value="tirage">Tirage en cours</option>
                                <option value="config">En attente config.</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="dateInstallation">Date d'installation</label>
                            <input type="date" id="dateInstallation">
                        </div>
                    </div>
                </div>

                <div class="photo-section">
                    <h3 style="margin-bottom: 20px; color: #4CAF50;">üì∏ Documentation photos</h3>
                    <div class="photo-grid">
                        <div class="photo-item">
                            <label for="photo-bosse-recto">Bosse recto</label>
                            <div class="photo-preview" id="preview-bosse-recto">üì∑</div>
                            <input type="file" id="photo-bosse-recto" accept="image/*">
                        </div>
                        <div class="photo-item">
                            <label for="photo-bosse-verso">Bosse verso</label>
                            <div class="photo-preview" id="preview-bosse-verso">üì∑</div>
                            <input type="file" id="photo-bosse-verso" accept="image/*">
                        </div>
                        <div class="photo-item">
                            <label for="photo-installation">Installation</label>
                            <div class="photo-preview" id="preview-installation">üì∑</div>
                            <input type="file" id="photo-installation" accept="image/*">
                        </div>
                        <div class="photo-item">
                            <label for="photo-tour">Tour</label>
                            <div class="photo-preview" id="preview-tour">üì∑</div>
                            <input type="file" id="photo-tour" accept="image/*">
                        </div>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="poteau-implante" onchange="togglePoteauSection()">
                        <label for="poteau-implante">Poteau implant√©</label>
                    </div>
                    <div class="poteau-section" id="poteau-details">
                        <div class="photo-item">
                            <label for="photo-poteau">Photo du poteau</label>
                            <div class="photo-preview" id="preview-poteau">üì∑</div>
                            <input type="file" id="photo-poteau" accept="image/*">
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="nom-poteau">Nom du poteau</label>
                                <input type="text" id="nom-poteau">
                            </div>
                            <div class="form-group">
                                <label for="type-poteau">Type de poteau</label>
                                <input type="text" id="type-poteau">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="buttons">
                    <button class="btn-primary" onclick="addClient()">üíæ Enregistrer client</button>
                    <button class="btn-warning" onclick="clearAddForm()">üóë Effacer</button>
                </div>
            </div>

            <div id="reports" class="tab-content">
                <div class="report-form">
                    <h3 style="color: var(--primary-color); margin-bottom: 15px;">üîç G√©n√©rer un bilan</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="report-start-date">Date de d√©but</label>
                            <input type="date" id="report-start-date">
                        </div>
                        <div class="form-group">
                            <label for="report-end-date">Date de fin</label>
                            <input type="date" id="report-end-date">
                        </div>
                        <div class="form-group">
                            <label for="report-status">Statut</label>
                            <select id="report-status">
                                <option value="all">Tous</option>
                                <option value="pending">En attente</option>
                                <option value="active">Active</option>
                                <option value="completed">Termin√©e</option>
                                <option value="tirage">Tirage en cours</option>
                                <option value="config">En attente config.</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="report-ville">Ville</label>
                            <input type="text" id="report-ville" placeholder="Filtrer par ville">
                        </div>
                    </div>
                    <div class="buttons">
                        <button class="btn-primary" onclick="generateWeeklyReport()">G√©n√©rer le bilan</button>
                    </div>
                </div>
                <div id="report-content" class="data-table">
                    <p>Utilisez le formulaire ci-dessus pour g√©n√©rer un bilan.</p>
                </div>
            </div>

            <div id="manage" class="tab-content">
                <div class="data-table">
                    <div class="table-header">
                        <h3>Gestion des clients</h3>
                        <input type="text" class="search-box" id="manageSearchInput" placeholder="Rechercher un client..." onkeyup="filterTable('manageClientsTableBody', this.value)">
                    </div>
                    <table id="manageClientsTable">
                        <thead>
                            <tr>
                                <th>Nom</th>
                                <th>Contact</th>
                                <th>Ville</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="manageClientsTableBody"></tbody>
                    </table>
                </div>
            </div>

            <div id="export" class="tab-content">
                <div class="export-options">
                    <h3 style="color: var(--primary-color); margin-bottom: 15px;">üì• Options d'exportation</h3>
                    <p>Exporter les donn√©es des clients au format JSON ou CSV.</p>
                    <div class="buttons">
                        <button class="btn-primary" onclick="exportData('json')">Exporter en JSON</button>
                        <button class="btn-primary" onclick="exportData('csv')">Exporter en CSV</button>
                    </div>
                </div>
            </div>

            <div id="clientModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>D√©tails du client</h2>
                        <span class="close" onclick="closeModal()">&times;</span>
                    </div>
                    <div id="modalContent"></div>
                    <div class="buttons">
                        <button class="btn-primary" id="editModalBtn" onclick="">‚úè Modifier</button>
                        <button class="btn-danger" id="deleteModalBtn" onclick="">üóë Supprimer</button>
                    </div>
                </div>
            </div>

            <div id="notification" class="notification"></div>
        </div>
    </div>

    <script>
        let clients = JSON.parse(localStorage.getItem('clients')) || [];
        let editingClientId = null;

        // --- Logique de l'interface utilisateur ---
        function switchTab(tabId) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.querySelector(`button[onclick="switchTab('${tabId}')"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');
            if (tabId === 'dashboard' || tabId === 'manage') updateClientTables();
        }

        function togglePoteauSection() {
            const poteauSection = document.getElementById('poteau-details');
            poteauSection.classList.toggle('active', document.getElementById('poteau-implante').checked);
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.remove('success', 'error');
            notification.classList.add('show', type);
            setTimeout(() => notification.classList.remove('show'), 3000);
        }

        function closeModal() {
            document.getElementById('clientModal').style.display = 'none';
        }

        function clearAddForm() {
            document.getElementById('add-client').querySelectorAll('input, select').forEach(input => {
                if (input.type === 'file') {
                    input.value = '';
                    const previewId = `preview-${input.id.split('-').slice(1).join('-')}`;
                    document.getElementById(previewId).innerHTML = 'üì∑';
                } else if (input.type === 'checkbox') {
                    input.checked = false;
                } else {
                    input.value = '';
                }
            });
            document.getElementById('poteau-details').classList.remove('active');
            editingClientId = null;
        }

        // --- Gestion des donn√©es ---
        function addClient() {
            const requiredFields = ['clientName', 'contactPrincipal', 'ville'];
            for (const fieldId of requiredFields) {
                if (!document.getElementById(fieldId).value) {
                    showNotification('Veuillez remplir tous les champs obligatoires.', 'error');
                    return;
                }
            }

            const photos = {};
            const photoInputs = ['photo-bosse-recto', 'photo-bosse-verso', 'photo-installation', 'photo-tour', 'photo-poteau'];
            photoInputs.forEach(id => {
                const fileInput = document.getElementById(id);
                if (fileInput.files[0]) {
                    photos[id.replace('photo-', '')] = fileInput.files[0].name;
                }
            });

            const client = {
                id: editingClientId || Date.now(),
                name: document.getElementById('clientName').value,
                contactPrincipal: document.getElementById('contactPrincipal').value,
                contactSecondaire: document.getElementById('contactSecondaire').value,
                ville: document.getElementById('ville').value,
                quartier: document.getElementById('quartier').value,
                numeroFTTH: document.getElementById('numeroFTTH').value,
                status: document.getElementById('statusInstallation').value,
                date: document.getElementById('dateInstallation').value,
                photos: photos,
                poteau: document.getElementById('poteau-implante').checked ? {
                    name: document.getElementById('nom-poteau').value,
                    type: document.getElementById('type-poteau').value
                } : null
            };

            if (editingClientId) {
                const index = clients.findIndex(c => c.id === editingClientId);
                if (index !== -1) {
                    clients[index] = client;
                }
                editingClientId = null;
            } else {
                clients.push(client);
            }

            localStorage.setItem('clients', JSON.stringify(clients));
            clearAddForm();
            updateDashboard();
            updateClientTables();
            showNotification(`Client ${editingClientId ? 'modifi√©' : 'ajout√©'} avec succ√®s !`);
            switchTab('dashboard');
        }

        function editClient(id) {
            const client = clients.find(c => c.id === id);
            if (!client) return;
            editingClientId = id;
            document.getElementById('clientName').value = client.name;
            document.getElementById('contactPrincipal').value = client.contactPrincipal;
            document.getElementById('contactSecondaire').value = client.contactSecondaire || '';
            document.getElementById('ville').value = client.ville;
            document.getElementById('quartier').value = client.quartier || '';
            document.getElementById('numeroFTTH').value = client.numeroFTTH || '';
            document.getElementById('statusInstallation').value = client.status;
            document.getElementById('dateInstallation').value = client.date || '';
            document.getElementById('poteau-implante').checked = !!client.poteau;
            togglePoteauSection();
            if (client.poteau) {
                document.getElementById('nom-poteau').value = client.poteau.name || '';
                document.getElementById('type-poteau').value = client.poteau.type || '';
            }
            showNotification('Mode de modification activ√©. Remplissez le formulaire ci-dessous.');
            switchTab('add-client');
            closeModal();
        }

        function deleteClient(id) {
            if (confirm('Voulez-vous vraiment supprimer ce client ?')) {
                clients = clients.filter(c => c.id !== id);
                localStorage.setItem('clients', JSON.stringify(clients));
                updateDashboard();
                updateClientTables();
                showNotification('Client supprim√© avec succ√®s !');
                closeModal();
            }
        }

        // --- Rapports et export ---
        function generateWeeklyReport() {
            const startDate = document.getElementById('report-start-date').value;
            const endDate = document.getElementById('report-end-date').value;
            const status = document.getElementById('report-status').value;
            const ville = document.getElementById('report-ville').value;
            const reportContent = document.getElementById('report-content');

            let filteredClients = clients;
            if (startDate) filteredClients = filteredClients.filter(c => c.date >= startDate);
            if (endDate) filteredClients = filteredClients.filter(c => c.date <= endDate);
            if (status !== 'all') filteredClients = filteredClients.filter(c => c.status === status);
            if (ville) filteredClients = filteredClients.filter(c => c.ville.toLowerCase().includes(ville.toLowerCase()));

            if (filteredClients.length === 0) {
                reportContent.innerHTML = '<p>Aucun client ne correspond aux crit√®res de recherche.</p>';
                return;
            }

            let reportHTML = `<h3>R√©sultats du bilan (${filteredClients.length} clients)</h3>`;
            reportHTML += `<table>
                <thead>
                    <tr>
                        <th>Nom</th>
                        <th>Contact</th>
                        <th>Ville</th>
                        <th>Statut</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>`;
            filteredClients.forEach(client => {
                reportHTML += `
                    <tr>
                        <td>${client.name}</td>
                        <td>${client.contactPrincipal}</td>
                        <td>${client.ville}</td>
                        <td><span class="status-badge status-${client.status}">${client.status}</span></td>
                        <td>${client.date || '-'}</td>
                    </tr>
                `;
            });
            reportHTML += `</tbody></table>`;
            reportContent.innerHTML = reportHTML;
        }

        function exportData(format) {
            if (clients.length === 0) {
                showNotification("Aucune donn√©e √† exporter.", "error");
                return;
            }

            let dataStr;
            let fileType;
            let fileName;

            if (format === 'json') {
                dataStr = JSON.stringify(clients, null, 2);
                fileType = 'application/json';
                fileName = 'clients_ftth.json';
            } else if (format === 'csv') {
                const headers = ["id", "name", "contactPrincipal", "contactSecondaire", "ville", "quartier", "numeroFTTH", "status", "date"];
                const csvRows = [
                    headers.join(';'),
                    ...clients.map(client => {
                        const values = headers.map(header => {
                            let value = client[header] || '';
                            if (typeof value === 'string') {
                                value = `"${value.replace(/"/g, '""')}"`;
                            }
                            return value;
                        });
                        return values.join(';');
                    })
                ];
                dataStr = csvRows.join('\n');
                fileType = 'text/csv';
                fileName = 'clients_ftth.csv';
            }

            const blob = new Blob([dataStr], { type: fileType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showNotification(`Donn√©es export√©es en ${format.toUpperCase()} avec succ√®s !`);
        }

        // --- Rendu et filtrage des tableaux ---
        function updateClientTables() {
            const mainTableBody = document.getElementById('clientsTableBody');
            const manageTableBody = document.getElementById('manageClientsTableBody');

            mainTableBody.innerHTML = '';
            manageTableBody.innerHTML = '';

            clients.forEach(client => {
                const mainRow = document.createElement('tr');
                mainRow.innerHTML = `
                    <td>${client.name}</td>
                    <td>${client.contactPrincipal}</td>
                    <td>${client.ville}</td>
                    <td>${client.quartier || '-'}</td>
                    <td>${client.numeroFTTH || '-'}</td>
                    <td><span class="status-badge status-${client.status}">${client.status}</span></td>
                    <td>${client.date || '-'}</td>
                    <td class="action-buttons">
                        <button class="btn-primary btn-small" onclick="viewClient(${client.id})">üëÅ</button>
                        <button class="btn-warning btn-small" onclick="editClient(${client.id})">‚úè</button>
                        <button class="btn-danger btn-small" onclick="deleteClient(${client.id})">üóë</button>
                    </td>
                `;
                mainTableBody.appendChild(mainRow);

                const manageRow = document.createElement('tr');
                manageRow.innerHTML = `
                    <td>${client.name}</td>
                    <td>${client.contactPrincipal}</td>
                    <td>${client.ville}</td>
                    <td><span class="status-badge status-${client.status}">${client.status}</span></td>
                    <td class="action-buttons">
                        <button class="btn-primary btn-small" onclick="viewClient(${client.id})">üëÅ</button>
                        <button class="btn-warning btn-small" onclick="editClient(${client.id})">‚úè</button>
                        <button class="btn-danger btn-small" onclick="deleteClient(${client.id})">üóë</button>
                    </td>
                `;
                manageTableBody.appendChild(manageRow);
            });
        }

        function filterTable(tableBodyId, query) {
            const rows = document.getElementById(tableBodyId).getElementsByTagName('tr');
            const search = query.toLowerCase();
            Array.from(rows).forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(search) ? '' : 'none';
            });
        }

        // --- Op√©rations principales ---
        function updateDashboard() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('totalClients').textContent = clients.length;
            document.getElementById('activeInstallations').textContent = clients.filter(c => c.status === 'active').length;
            document.getElementById('pendingInstallations').textContent = clients.filter(c => c.status === 'pending').length;
            document.getElementById('completedToday').textContent = clients.filter(c => c.status === 'completed' && c.date === today).length;
            document.getElementById('tirageEnCours').textContent = clients.filter(c => c.status === 'tirage').length;
            document.getElementById('attenteCofig').textContent = clients.filter(c => c.status === 'config').length;
        }

        function viewClient(id) {
            const client = clients.find(c => c.id === id);
            if (!client) return;
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <p><strong>Nom :</strong> ${client.name}</p>
                <p><strong>Contact principal :</strong> ${client.contactPrincipal}</p>
                <p><strong>Contact secondaire :</strong> ${client.contactSecondaire || '-'}</p>
                <p><strong>Ville :</strong> ${client.ville}</p>
                <p><strong>Quartier :</strong> ${client.quartier || '-'}</p>
                <p><strong>Num√©ro FTTH :</strong> ${client.numeroFTTH || '-'}</p>
                <p><strong>Statut :</strong> <span class="status-badge status-${client.status}">${client.status}</span></p>
                <p><strong>Date :</strong> ${client.date || '-'}</p>
                ${client.poteau ? `
                    <h3>Poteau</h3>
                    <p><strong>Nom du poteau :</strong> ${client.poteau.name || '-'}</p>
                    <p><strong>Type :</strong> ${client.poteau.type || '-'}</p>
                ` : ''}
                <h3>Photos</h3>
                <div class="photo-gallery">
                    ${Object.keys(client.photos).map(key => `<p>Nom du fichier : ${client.photos[key]}</p>`).join('')}
                    <p>Note : Les photos ne sont pas stock√©es dans le navigateur pour des raisons de performance.</p>
                </div>
            `;
            document.getElementById('editModalBtn').setAttribute('onclick', `editClient(${client.id})`);
            document.getElementById('deleteModalBtn').setAttribute('onclick', `deleteClient(${client.id})`);
            document.getElementById('clientModal').style.display = 'block';
        }

        // --- √âcouteurs d'√©v√©nements ---
        document.addEventListener('DOMContentLoaded', () => {
            updateDashboard();
            updateClientTables();
        });

        document.getElementById('photo-bosse-recto').addEventListener('change', function() {
            if (this.files[0]) document.getElementById('preview-bosse-recto').innerHTML = 'üì∑ ‚úÖ';
        });
        document.getElementById('photo-bosse-verso').addEventListener('change', function() {
            if (this.files[0]) document.getElementById('preview-bosse-verso').innerHTML = 'üì∑ ‚úÖ';
        });
        document.getElementById('photo-installation').addEventListener('change', function() {
            if (this.files[0]) document.getElementById('preview-installation').innerHTML = 'üì∑ ‚úÖ';
        });
        document.getElementById('photo-tour').addEventListener('change', function() {
            if (this.files[0]) document.getElementById('preview-tour').innerHTML = 'üì∑ ‚úÖ';
        });
        document.getElementById('photo-poteau').addEventListener('change', function() {
            if (this.files[0]) document.getElementById('preview-poteau').innerHTML = 'üì∑ ‚úÖ';
        });
    </script>
</body>
</html>